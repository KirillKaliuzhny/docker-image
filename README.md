# Site in Docker
## Введение
Данная сборка рассчитана на оперативное развертывание легковесных и не очень сайтов. Находится в разработке. Подойдет для разберающихся в докере.
## Уже реализовано
 - Окружение на основе PHP
    - Поддержка MariaDB
    - Поддержка Microsoft SQL Server
    - Поддержка Postgres
    - Adminer для удобства
 - Окружение на основе Node (проверено на vue/react)
## Настройка
### Инициализация проекта
На данный момент есть возможность развернуть связку backend + frontend + nginx + db.
#### backend
##### PHP
Для стартовой инициализации проекта необходимо:

1. Произвести базовую настройку под себя в Dockerfile (лежит по пути www/backend/build).
2. После запуска контейнера необходимо войти в него через docker compose exec php-fpm bash и установить необходимый фреймворк или подтянуть зависимости.
3. После сайт будет открыт по пути http://localhost

##### Node
Для стартовой инициализации проекта необходимо:

1. Произвести базовую настройку под себя в Dockerfile (лежит по пути www/frontend/build).
2. Если не устраивает пользователь, под которым работает проект, то он устанавливается на уровне .yml файла, лежит тут docker-compose/node.yml
3. После сборки проекта необходимо зайти в контернер через docker compose run --rm node bash и установить нужное окружение (Версия ноды устанавливается в общем .env файле)
4. После установки окружения выходим из контейнера и запускаем все контейнеры через docker compose up -d
5. Если не менялись порты, то приложение откроется на http://localhost:5173

## Возможные проблемы

### Node

#### Не открывается приложение vue и подобных по указанному порту.

Нужно пробрасывать работу приложения на все порты внутри контейнера, код на примере vue

Файл vite.config.ts:

```ts

export default defineConfig(({ command }) => {
    return {
        plugins: [
            vue(),
            vueDevTools(),
        ],
        resolve: {
            alias: {
            '@': fileURLToPath(new URL('./src', import.meta.url))
            },
        },
        server: {
            port: 5173,
            host: '0.0.0.0',
        }
    }
});

```

### БД

#### Microsoft SQL server

Может быть такое, что на локали подключение не устанавливается, во первых, проверьте, что все пакеты для данной бд установлены в Dockerfile (раскомментированы), во вторых нужно отключить проверку сертификата. Код на примере laravel:

config/database.php  
```php
 'connections' => [
    ...
    'sqlsrv' => [
        ...
        'trust_server_certificate' => env('DB_TRUST_SERVER_CERTIFICATE', 'true'),
        'options' => [
            'ConnectionPooling' => 'true'
        ]
    ],
 ]
```
На данном этапе отключается проверка сертификата и в опциях задается значение, ускоряющее взаимодействие в БД.

## В планах
1. Расширять документацию по репозиторию
2. Реализация работы с Python на бекенде